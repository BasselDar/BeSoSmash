<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BeSoSmash</title>
    <link rel="icon"
        href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><path d='M50,0 L65,35 L100,50 L65,65 L50,100 L35,65 L0,50 L35,35 Z' fill='%23f43f5e' stroke='%230f172a' stroke-width='8' stroke-linejoin='round'/><path d='M50,15 L60,40 L85,50 L60,60 L50,85 L40,60 L15,50 L40,40 Z' fill='%23eab308'/></svg>"
        type="image/svg+xml">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="/socket.io/socket.io.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js"></script>
    <link
        href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700;800&family=Outfit:wght@400;700;900&display=swap"
        rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Outfit', 'sans-serif'],
                        mono: ['"JetBrains Mono"', 'monospace'],
                    },
                    animation: {
                        'gradient-x': 'gradient-x 15s ease infinite',
                    },
                    keyframes: {
                        'gradient-x': {
                            '0%, 100%': {
                                'background-size': '200% 200%',
                                'background-position': 'left center'
                            },
                            '50%': {
                                'background-size': '200% 200%',
                                'background-position': 'right center'
                            },
                        },
                    }
                }
            }
        }
    </script>
    <style>
        /* A little custom CSS for the arcade glow */
        .neon-glow {
            text-shadow: 0 0 10px currentColor, 0 0 20px currentColor, 0 0 30px currentColor;
        }

        .box-glow {
            box-shadow: 0 0 15px currentColor, inset 0 0 10px currentColor;
        }

        body {
            background: linear-gradient(-45deg, #0f172a, #1e1b4b, #312e81, #0f172a);
            background-size: 400% 400%;
        }

        .glass-panel {
            background: rgba(15, 23, 42, 0.4);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
        }
    </style>
</head>

<body
    class="text-white font-sans flex flex-col items-center min-h-screen p-5 transition-colors duration-100 animate-gradient-x overflow-x-hidden">

    <header class="text-center mt-6 mb-4 z-10 relative">
        <div
            class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-48 h-48 md:w-64 md:h-64 opacity-40 pointer-events-none -z-10">
            <svg viewBox="0 0 200 200" class="w-full h-full animate-[spin_15s_linear_infinite]">
                <path fill="url(#explosionGradClassic)" filter="url(#glowClassic)"
                    d="M100,0 L118,65 L195,15 L140,85 L200,125 L130,125 L155,195 L100,145 L45,195 L70,125 L0,125 L60,85 L5,15 L82,65 Z" />
                <defs>
                    <linearGradient id="explosionGradClassic" x1="0%" y1="0%" x2="100%" y2="100%">
                        <stop offset="0%" stop-color="#f43f5e" stop-opacity="0.9" />
                        <stop offset="50%" stop-color="#a855f7" stop-opacity="0.9" />
                        <stop offset="100%" stop-color="#eab308" stop-opacity="0.9" />
                    </linearGradient>
                    <filter id="glowClassic" x="-20%" y="-20%" width="140%" height="140%">
                        <feGaussianBlur stdDeviation="6" result="blur" />
                        <feComposite in="SourceGraphic" in2="blur" operator="over" />
                    </filter>
                </defs>
            </svg>
        </div>

        <div onclick="window.location.href='/'"
            class="relative inline-block transform -rotate-3 hover:scale-105 hover:-translate-y-2 hover:rotate-0 transition-all duration-300 pb-2 group cursor-pointer">
            <!-- Shadow Layer -->
            <h1 aria-hidden="true"
                class="absolute top-0 left-0 w-full h-full text-7xl md:text-8xl pb-2 font-black uppercase italic tracking-tighter text-[#0f172a] select-none whitespace-nowrap pr-4 transition-all duration-300 group-hover:drop-shadow-[0_15px_15px_rgba(244,63,94,0.3)] group-hover:translate-x-3 group-hover:translate-y-3"
                style="-webkit-text-stroke: 12px #0f172a; transform: translate(6px, 6px);">
                BeSo<span class="text-transparent">Smash</span>
            </h1>
            <h1 aria-hidden="true"
                class="absolute top-0 left-0 w-full h-full text-7xl md:text-8xl pb-2 font-black uppercase italic tracking-tighter text-[#0f172a] select-none whitespace-nowrap pr-4 transition-all duration-300 group-hover:drop-shadow-[0_15px_15px_rgba(234,179,8,0.3)] group-hover:translate-x-3 group-hover:translate-y-3"
                style="-webkit-text-stroke: 12px #0f172a; transform: translate(6px, 6px);">
                <span class="text-transparent">BeSo</span>Smash
            </h1>

            <!-- Outline Layer -->
            <h1 aria-hidden="true"
                class="absolute top-0 left-0 w-full h-full text-7xl md:text-8xl pb-2 font-black uppercase italic tracking-tighter text-[#0f172a] select-none whitespace-nowrap pr-4"
                style="-webkit-text-stroke: 12px #0f172a;">
                BeSoSmash
            </h1>

            <!-- Foreground Layer -->
            <h1
                class="relative text-7xl md:text-8xl pb-2 font-black uppercase italic tracking-tighter group-hover:brightness-110 transition-all duration-300">
                <span
                    class="inline-block pr-4 text-transparent bg-clip-text bg-gradient-to-br from-indigo-400 via-purple-500 to-fuchsia-500 drop-shadow-[0_0_15px_rgba(168,85,247,0.5)]">BeSo</span><span
                    class="inline-block pr-4 text-transparent bg-clip-text bg-gradient-to-br from-rose-500 via-orange-500 to-yellow-500 drop-shadow-[0_0_15px_rgba(244,63,94,0.5)]">Smash</span>
            </h1>
        </div>

        <div class="mt-4">
            <p
                class="text-slate-200 font-black tracking-[0.2em] text-xs md:text-sm border-y-2 border-slate-500/50 py-1 inline-block px-6 bg-black/50 backdrop-blur-sm shadow-[0_0_15px_rgba(0,0,0,0.6)] transform rotate-1 uppercase">
                GLOBAL KEYBOARD DESTRUCTION EVENT
            </p>
        </div>
    </header>
    <%- include('partials/nav') %>
        <div class="w-full max-w-3xl mb-8 relative">
            <!-- Wrapper just for the shake animation -->
            <div class="rounded-3xl" style="margin: -20px; padding: 20px;">
                <div id="game-container" class="w-full text-center z-10">

                    <div id="setup-panel" class="mb-5 glass-panel p-10 rounded-3xl relative overflow-hidden group">
                        <div
                            class="absolute inset-0 bg-gradient-to-br from-white/5 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-500 pointer-events-none">
                        </div>
                        <h2 class="text-3xl font-black text-yellow-400 mb-8 tracking-wider">CHOOSE YOUR CODENAME</h2>
                        <div class="flex justify-center items-center gap-6">
                            <div class="relative group">
                                <input type="text" id="username" placeholder="CODENAME" maxlength="12"
                                    class="bg-black/50 border border-slate-600/50 text-white text-3xl p-5 rounded-2xl text-center w-72 focus:outline-none focus:border-rose-500 focus:ring-4 focus:ring-rose-500/30 uppercase transition-all font-black shadow-inner">
                                <button id="change-name-btn" onclick="clearCodename()"
                                    class="hidden absolute right-4 top-1/2 -translate-y-1/2 text-slate-500 hover:text-rose-500 hover:scale-110 transition-all cursor-pointer z-10"
                                    title="Change Codename">
                                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z">
                                        </path>
                                    </svg>
                                </button>
                            </div>
                            <button onclick="startGame('classic')"
                                class="bg-gradient-to-r from-rose-600 to-orange-500 hover:from-rose-500 hover:to-orange-400 text-white font-black py-5 px-10 rounded-2xl text-3xl shadow-[0_0_20px_rgba(225,29,72,0.6)] hover:shadow-[0_0_35px_rgba(225,29,72,0.8)] hover:scale-105 transition-all duration-300 active:scale-95 border border-white/20 relative overflow-hidden group/btn">
                                <span class="relative z-10">SMASH</span>
                                <div
                                    class="absolute inset-0 bg-white/20 translate-y-full group-hover/btn:translate-y-0 transition-transform duration-300">
                                </div>
                            </button>
                        </div>
                    </div>

                    <!-- Post-Game Match Summary Panel -->
                    <div id="game-over-panel"
                        class="hidden mb-5 glass-panel p-10 rounded-3xl relative overflow-hidden group">
                        <div
                            class="absolute inset-0 bg-gradient-to-br from-rose-600/10 to-transparent pointer-events-none">
                        </div>
                        <!-- Game Over Logo Header -->
                        <div class="flex justify-center mb-6">
                            <h2 class="text-6xl md:text-7xl font-black uppercase italic tracking-tighter whitespace-nowrap"
                                style="text-shadow: 0 0 20px rgba(168,85,247,0.5);">
                                <span
                                    class="text-transparent bg-clip-text bg-gradient-to-br from-indigo-400 to-fuchsia-500 pr-4 -mr-4 relative z-10">BeSo</span><span
                                    class="text-transparent bg-clip-text bg-gradient-to-br from-rose-500 to-yellow-500 relative z-0 pr-4">Smash</span>
                            </h2>
                        </div>
                        <p
                            class="text-rose-500 font-bold tracking-widest text-sm mb-1 uppercase drop-shadow-md text-center">
                            DIAGNOSIS COMPLETE FOR</p>
                        <h3 id="final-name-display"
                            class="text-5xl md:text-6xl font-black text-white mb-8 tracking-wider uppercase text-center"
                            style="text-shadow: 0 4px 6px rgba(0,0,0,0.5), 0 0 15px rgba(255,255,255,0.4);">
                            PLAYER
                        </h3>

                        <div
                            class="flex flex-col items-center justify-center gap-2 mb-8 bg-black/40 p-6 rounded-2xl border border-white/5 relative overflow-hidden">
                            <div
                                class="absolute -top-10 -right-10 w-32 h-32 bg-rose-500/10 rounded-full blur-2xl pointer-events-none">
                            </div>
                            <span class="text-slate-500 font-black text-xs tracking-widest uppercase z-10">FINAL
                                SCORE</span>
                            <span id="final-score-display"
                                class="text-7xl font-mono font-black text-yellow-500 drop-shadow-[0_0_25px_rgba(234,179,8,0.6)] z-10">0</span>
                            <span id="final-rank-display" class="text-2xl font-black mt-2 z-10">NOVICE</span>

                            <div
                                class="flex flex-wrap w-full justify-between items-center mt-6 pt-6 border-t border-white/10 px-0 md:px-2 gap-y-4">
                                <div class="text-center w-1/2 md:w-1/4 md:border-r border-white/10">
                                    <p class="text-slate-500 font-bold text-[10px] tracking-widest uppercase mb-1">
                                        GLOBAL RANK</p>
                                    <p id="absolute-rank-display"
                                        class="font-mono text-xl md:text-3xl font-black text-white">#--
                                    </p>
                                </div>
                                <div class="text-center w-1/2 md:w-1/4 md:border-r border-white/10">
                                    <p class="text-slate-500 font-bold text-[10px] tracking-widest uppercase mb-1">
                                        KEYS SMASHED</p>
                                    <p id="final-keys-display"
                                        class="font-mono text-xl md:text-3xl font-black text-amber-500">0
                                    </p>
                                </div>
                                <div class="text-center w-1/2 md:w-1/4 md:border-r border-white/10">
                                    <p class="text-slate-500 font-bold text-[10px] tracking-widest uppercase mb-1">
                                        ENTROPY</p>
                                    <p id="final-entropy-display"
                                        class="font-mono text-xl md:text-3xl font-black text-rose-400">0.0<span
                                            class="text-sm">%</span>
                                    </p>
                                </div>
                                <div class="text-center w-1/2 md:w-1/4">
                                    <p class="text-slate-500 font-bold text-[10px] tracking-widest uppercase mb-1">AVG
                                        SPEED</p>
                                    <p id="final-kps-display"
                                        class="font-mono text-xl md:text-3xl font-black text-sky-400">0.0
                                        <span class="text-sm">KPS</span>
                                    </p>
                                </div>
                            </div>
                        </div>

                        <!-- Personality Profile Section -->
                        <div class="mt-4 mb-8 w-full">
                            <h3 class="text-sm font-black text-slate-500 tracking-widest uppercase mb-4 text-center">
                                DIAGNOSIS</h3>
                            <div id="profile-container" class="grid grid-cols-1 md:grid-cols-2 gap-4 text-center">
                            </div>
                        </div>

                        <div class="flex justify-center items-center gap-2 md:gap-4 w-full flex-wrap">
                            <button onclick="shareScore()"
                                class="flex-1 bg-slate-800 hover:bg-slate-700 text-slate-300 font-black py-4 px-4 rounded-2xl text-[10px] md:text-sm transition-all duration-300 active:scale-95 border border-slate-600 hover:text-white shadow-lg flex justify-center items-center gap-2 whitespace-nowrap">
                                SHARE
                            </button>
                            <button onclick="saveCardImage()"
                                class="flex-1 bg-indigo-900/50 hover:bg-indigo-800/80 text-indigo-300 font-black py-4 px-4 rounded-2xl text-[10px] md:text-sm transition-all duration-300 active:scale-95 border border-indigo-500/30 hover:text-white shadow-lg flex justify-center items-center gap-2 whitespace-nowrap">
                                SAVE CARD
                            </button>
                            <button onclick="resetGame()"
                                class="w-full md:flex-1 bg-gradient-to-r from-rose-600 to-orange-500 hover:from-rose-500 hover:to-orange-400 text-white font-black py-4 px-6 rounded-2xl text-xl shadow-[0_0_20px_rgba(225,29,72,0.6)] hover:shadow-[0_0_35px_rgba(225,29,72,0.8)] hover:scale-[1.02] transition-all duration-300 active:scale-95 border border-white/20 whitespace-nowrap">
                                PLAY AGAIN
                            </button>
                        </div>
                    </div>

                    <div id="smash-zone"
                        class="hidden relative glass-panel border-4 border-dashed border-rose-500/50 rounded-3xl p-8 flex flex-col items-center justify-center select-none box-glow text-rose-500 h-96 transition-all">

                        <div class="absolute top-6 left-8 text-left">
                            <p class="text-slate-400/80 text-sm font-bold tracking-widest uppercase">KPS (Keys/Sec)</p>
                            <p id="kps-display"
                                class="text-4xl font-mono font-black text-yellow-400 drop-shadow-[0_0_10px_rgba(250,204,21,0.5)]">
                                0.0</p>
                        </div>

                        <div class="absolute top-6 right-8 text-right flex flex-col items-end">
                            <div
                                class="flex items-center gap-2 bg-rose-500/20 px-3 py-1 rounded-full border border-rose-500/30 mb-2">
                                <span id="timer-display"
                                    class="font-mono font-black text-xl text-rose-300 w-16 text-right">5.00s</span>
                            </div>
                        </div>

                        <div class="absolute bottom-6 right-8 text-right">
                            <p class="text-slate-400/80 text-sm font-bold tracking-widest uppercase">CURRENT RANK</p>
                            <p id="rank-display" class="text-3xl font-black text-slate-300 neon-glow">NOVICE</p>
                        </div>

                        <h2 id="status-text"
                            class="text-4xl font-black text-white mix-blend-overlay opacity-80 mt-12 tracking-widest">
                            SMASH YOUR
                            KEYBOARD!
                        </h2>
                        <div id="score-display"
                            class="text-[12rem] font-mono font-black text-white leading-none tracking-tighter neon-glow mt-4">
                            0
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="leaderboard-section"
            class="w-full max-w-4xl glass-panel p-8 md:p-12 rounded-3xl z-10 relative overflow-hidden mt-8 shadow-[0_0_50px_rgba(0,0,0,0.6)] border border-white/5">
            <div
                class="absolute top-0 inset-x-0 h-1 bg-gradient-to-r from-transparent via-yellow-400/50 to-transparent">
            </div>

            <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-8 gap-4 flex-wrap">
                <h3
                    class="text-4xl md:text-5xl font-black text-transparent bg-clip-text bg-gradient-to-r from-yellow-400 to-amber-600 flex items-center gap-3 drop-shadow-[0_0_15px_rgba(250,204,21,0.3)]">
                    HALL OF CHAOS
                </h3>
                <span
                    class="text-xs font-bold text-emerald-400 tracking-widest uppercase bg-emerald-400/10 px-4 py-2 rounded-full border border-emerald-400/20 shadow-[0_0_15px_rgba(52,211,153,0.3)] flex items-center gap-2">
                    <span class="w-2.5 h-2.5 rounded-full bg-emerald-400 animate-pulse"></span>
                    LIVE
                </span>
            </div>

            <div class="mb-8 relative group">
                <div class="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none">
                    <svg class="w-6 h-6 text-slate-400 group-focus-within:text-rose-500 transition-colors" fill="none"
                        stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                    </svg>
                </div>
                <input type="text" id="leaderboard-search" placeholder="SEARCH CODENAMES..."
                    class="w-full bg-black/60 border border-slate-700/50 text-white text-2xl p-5 pl-12 rounded-2xl focus:outline-none focus:border-rose-500 focus:ring-4 focus:ring-rose-500/20 transition-all placeholder:text-slate-600 uppercase font-bold shadow-inner block">
            </div>

            <ul id="leaderboard-list" class="space-y-4">
                <!-- Data fetched from API -->
            </ul>

            <div id="pagination-controls" class="mt-8 flex justify-center items-center gap-2 flex-wrap">
                <!-- Pagination buttons generated here -->
            </div>
        </div>
        <div id="toast-container"
            class="fixed top-10 left-1/2 -translate-x-1/2 z-50 flex flex-col gap-3 pointer-events-none"></div>
        <script type="module" src="/js/main.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
</body>

</html>